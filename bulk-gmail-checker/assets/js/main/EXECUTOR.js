const server1=`${SERVER_URL}/check1`,server2=`${SERVER_URL}/check2`,fastServer1=`${SERVER_URL}/fastcheck1`,fastServer2=`${SERVER_URL}/fastcheck2`;let selectedServer,abortController=null,chunks=[],currentProgress=0,fallbackAttempts={};const REQUEST_TIMEOUT=1e4;async function EXECUTE(){if(invalidEmails.length>0)return;emailInput.value=validEmails.join("\n");const e=emailInput.value.split("\n").map((e=>e.trim())).filter((e=>e.length>0));if(0===e.length)return;const t=isLanguageID?{generating:"<p>MEMBUAT KUNCI API</p><p>SILAHKAN TUNGGU...</p>",error:"KESALAHAN: GAGAL MEMBUAT KUNCI API. SILAKAN COBA LAGI.",button:'<i class="fas fa-play"></i> EKSEKUSI',initError:"Gagal menginisialisasi kunci API untuk dieksekusi."}:{generating:"<p>GENERATING API KEY</p><p>PLEASE WAIT...</p>",error:"ERROR: FAILED TO GENERATE API KEY. PLEASE TRY AGAIN.",button:'<i class="fas fa-play"></i> EXECUTE',initError:"Failed to initialize API key for execution."};if(!APIKEY){systemMessage.innerHTML=t.generating,executeBtn.innerHTML='<div class="loading-spinner"></div>';try{const e=await handleGenerateKey();APIKEY=e.APIKEY}catch(e){throw unsetExecutionUi(),systemMessage.textContent=t.error,console.error(t.initError,e),new Error(t.initError)}executeBtn.innerHTML=t.button}let s;setExecutionUi(),selectedServer=document.querySelector('input[name="server"]:checked').value,"server1"===selectedServer||"server2"===selectedServer?(verifyFilterBtn.classList.remove("hidden"),unregisteredFilterBtn.classList.remove("hidden"),disabledFilterBtn.classList.remove("hidden"),s=100):(verifyFilterBtn.classList.add("hidden"),unregisteredFilterBtn.classList.add("hidden"),disabledFilterBtn.classList.add("hidden"),s=1e4),chunks=[];for(let t=0;t<e.length;t+=s)chunks.push(e.slice(t,t+s));results=[],abortController=new AbortController,currentProgress=0,updateProgressBar(0),isLanguageID?systemMessage.textContent="MEMPROSES...":systemMessage.textContent="PROCESSING...";try{if(await processChunksWithFallback(chunks),abortController.signal.aborted)throw new Error("Aborted by user.");await animateProgressBar(currentProgress,100),progressOverlay.classList.add("hidden"),stopButttonContainer.classList.add("hidden"),outputButtonContainer.classList.remove("hidden"),apiStats.classList.remove("hidden"),closStatsAbsolute.classList.remove("hidden"),isLanguageID?systemMessage.textContent="EKSEKUSI SELESAI!":systemMessage.textContent="EXECUTION COMPLETED!","function"==typeof saveCurrentResults?await saveCurrentResults():(console.warn("saveCurrentResults not available, skipping history save"),setTimeout((()=>{"function"==typeof initHistorySystem&&initHistorySystem().then((()=>{"function"==typeof saveCurrentResults&&saveCurrentResults()}))}),500)),"function"==typeof updateApiStatsAfterExecution?await updateApiStatsAfterExecution(results.length):console.warn("updateApiStatsAfterExecution not available, skipping stats update"),updateCounters(),resultListContainer.scrollTop=0,displayResults()}catch(e){"EXECUTION CANCELLED"===e.name||"Aborted by user."===e.message||(console.error("Execution error:",e),unsetExecutionUi(),systemMessage.textContent=`${e.message}`)}}const allServers={server1:{url:server1,type:"normal",chunkSize:100},server2:{url:server2,type:"normal",chunkSize:100},fastServer1:{url:fastServer1,type:"fast",chunkSize:1e4},fastServer2:{url:fastServer2,type:"fast",chunkSize:1e4}};async function processChunksWithFallback(e){if(!abortController.signal.aborted)for(let t=0;t<e.length;t++){if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");const s=e[t],r=(t+1)/e.length*100;fallbackAttempts[t]||(fallbackAttempts[t]={servers:Object.keys(allServers),currentServerIndex:0,originalSelectedServerType:allServers[selectedServer].type});const n=fallbackAttempts[t];let a=!1,i=0;for(;!a&&i<n.servers.length;){if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");const e=n.servers[n.currentServerIndex],{url:t,type:o}=allServers[e];try{i>0?isLanguageID?systemMessage.textContent=` ${e} terlalu lama merespon, mencoba server lain...`:systemMessage.textContent=`${e}' takes too long to respond, try another server...`:isLanguageID?systemMessage.textContent=`MEMPROSES... (${e})`:systemMessage.textContent=`PROCESSING... (${e})`;const n=await fetchWithTimeout(t,{method:"POST",headers:{Authorization:`Bearer ${APIKEY}`,"Content-Type":"application/json"},body:JSON.stringify({mail:s})},REQUEST_TIMEOUT,abortController.signal);if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");if(!n.ok)throw new Error(`Server returned ${n.status}: ${n.statusText}`);if(processApiResponse(await n.json(),o),abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");if(updateCounters(),displayResults(),await animateProgressBar(currentProgress,r),abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");a=!0,systemMessage.textContent=`PROCESSING... ${currentProgress.toFixed(0)}%`}catch(t){if("EXECUTION CANCELLED"===t.name)throw t;console.error(`Error with ${e}:`,t.message),i++,n.currentServerIndex=(n.currentServerIndex+1)%n.servers.length,await new Promise((e=>setTimeout(e,500)))}}if(!a)throw new Error(isLanguageID?"Eksekusi dibatalkan, terjadi kesalahan jaringan":"Execution aborted, network error occurred");if(t<e.length-1&&(await new Promise((e=>setTimeout(e,10))),abortController.signal.aborted))throw new Error("EXECUTION CANCELLED")}}function fetchWithTimeout(e,t,s,r){return new Promise(((n,a)=>{const i=new AbortController,o=setTimeout((()=>{i.abort(),a(new Error("Request timeout (10 seconds)"))}),s);r&&r.addEventListener("abort",(()=>{clearTimeout(o),i.abort(),a(new Error("EXECUTION CANCELLED"))}),{once:!0}),t.signal=i.signal,fetch(e,t).then((e=>{clearTimeout(o),n(e)})).catch((e=>{clearTimeout(o),a(e)}))}))}function processApiResponse(e,t){if(abortController&&abortController.signal.aborted)return;if(!Array.isArray(e))return void console.error("Invalid API response:",e);const s="normal"===t;e.forEach((e=>{let t=e.status.toLowerCase();if(s){t={bad:"bad",error:"bad",disabled:"disabled",live:"live",verify:"verify",unregistered:"unregistered"}[t]||"error"}else t="live"===t?"live":"bad";results.push({email:e.email,status:t,details:e.details||"Validated"})}))}function cancelExecution(){abortController&&(abortController.abort(),unsetExecutionUi(),isLanguageID?systemMessage.textContent="EKSEKUSI DIBATALKAN":systemMessage.textContent="EXECUTION CANCELLED")}function updateProgressBar(e){const t=Math.min(100,Math.max(0,e));donutChart.style.background=`conic-gradient(#cc0000 ${t}%, #333 ${t}% 100%)`,progressText.textContent=`${t.toFixed(0)}%`}async function animateProgressBar(e,t){const s=10*Math.abs(t-e),r=performance.now();return new Promise((n=>{requestAnimationFrame((function a(i){const o=i-r,l=Math.min(1,o/s),d=e+(t-e)*l;updateProgressBar(d),currentProgress=d,l<1&&!abortController.signal.aborted?requestAnimationFrame(a):(updateProgressBar(t),currentProgress=t,n())}))}))}function resetSystem(){createLoadingAnimation(duration="fast"),liveBackgroundMob.classList.add("hidden"),liveBackgroundDesk.classList.add("hidden"),results=[],currentFilter="all",filterBtns.forEach((e=>{e.classList.remove("active"),"all"===e.dataset.filter&&e.classList.add("active")})),resultList.innerHTML="",resultList.style.height="auto",resultListContainer.scrollTop=0,updateCounters(),updateProgressBar(0),inputSection.classList.remove("hidden"),emailInput.scrollTop=emailInput.scrollHeight,serverSelectionContainer.classList.remove("hidden"),inputButtonContainer.classList.remove("hidden"),myAccountButton.classList.remove("hidden"),systemInfoContainer.classList.remove("hidden"),closStatsAbsolute.classList.add("hidden"),executeBtn.disabled=!1,clearInputBtn.disabled=!1,pasteBtn.disabled=!1,uploadBtn.disabled=!1,executeBtn.innerHTML="",isLanguageID?executeBtn.innerHTML='<i class="fas fa-play"></i> EKSEKUSI':executeBtn.innerHTML='<i class="fas fa-play"></i> EXECUTE',validateInput(),systemMessage.style.cssText="",isLanguageID?systemMessage.textContent="SISTEM TELAH DIRESET.":systemMessage.textContent="SYSTEM HAS BEEN RESET.",outputSection.classList.add("hidden"),outputButtonContainer.classList.add("hidden"),progressOverlay.classList.add("hidden"),apiStats.classList.add("hidden"),blockUpdateMessages(!1),updateExecutionStatus(!1),fallbackAttempts={}}function backToMain(){results=[],currentFilter="all",filterBtns.forEach((e=>{e.classList.remove("active"),"all"===e.dataset.filter&&e.classList.add("active")})),resultList.innerHTML="",resultList.style.height="auto",resultListContainer.scrollTop=0,updateCounters(),inputSection.classList.remove("hidden"),emailInput.scrollTop=emailInput.scrollHeight,serverSelectionContainer.classList.remove("hidden"),inputButtonContainer.classList.remove("hidden"),clearInputBtn.classList.remove("hidden"),clearErrorsBtn.classList.add("hidden"),resetBtn.classList.remove("hidden"),backMyAccountBtn.classList.add("hidden"),validateInput(),systemMessage.style.cssText="",isLanguageID?systemMessage.textContent="MENUNGGU PERINTAH...":systemMessage.textContent="AWAITING COMMAND...",isLanguageID?resultTitle.textContent="HASIL":resultTitle.textContent="RESULTS",document.querySelector("main").style.background="",backgroundGlow.style.cssText="",outputSection.classList.add("hidden"),outputButtonContainer.classList.add("hidden"),progressOverlay.classList.add("hidden"),apiStats.classList.add("hidden"),blockUpdateMessages(!1),updateExecutionStatus(!1),fallbackAttempts={}}function setExecutionUi(){isMobile?(liveBackgroundMob.classList.remove("hidden"),liveBackgroundDesk.classList.add("hidden")):(liveBackgroundMob.classList.add("hidden"),liveBackgroundDesk.classList.remove("hidden")),progressOverlay.classList.remove("hidden"),stopButttonContainer.classList.remove("hidden"),executeBtn.disabled=!0,clearInputBtn.disabled=!0,pasteBtn.disabled=!0,uploadBtn.disabled=!0,systemMessage.style.innerHTML="",systemMessage.style.cssText="",backMyAccountBtn.classList.add("hidden"),executeBtn.disabled=!0,serverSelectionContainer.classList.add("hidden"),myAccountButton.classList.add("hidden"),errorInfo.classList.add("hidden"),inputButtonContainer.classList.add("hidden"),inputSection.classList.add("hidden"),systemInfoContainer.classList.remove("hidden"),outputSection.classList.remove("hidden"),resetBtn.classList.remove("hidden"),blockUpdateMessages(!0),updateExecutionStatus(!0)}function unsetExecutionUi(){createLoadingAnimation(duration="fast"),liveBackgroundMob.classList.add("hidden"),liveBackgroundDesk.classList.add("hidden"),results=[],currentFilter="all",filterBtns.forEach((e=>{e.classList.remove("active"),"all"===e.dataset.filter&&e.classList.add("active")})),resultList.innerHTML="",resultList.style.height="auto",resultListContainer.scrollTop=0,updateCounters(),updateProgressBar(0),progressOverlay.classList.add("hidden"),inputSection.classList.remove("hidden"),inputButtonContainer.classList.remove("hidden"),serverSelectionContainer.classList.remove("hidden"),systemInfoContainer.classList.remove("hidden"),executeBtn.disabled=!1,clearInputBtn.classList.remove("hidden"),clearErrorsBtn.classList.add("hidden"),myAccountButton.classList.remove("hidden"),systemMessage.style.innerHTML="",systemMessage.style.cssText="",executeBtn.disabled=!1,clearInputBtn.disabled=!1,pasteBtn.disabled=!1,uploadBtn.disabled=!1,validateInput(),resetBtn.classList.add("hidden"),stopButttonContainer.classList.add("hidden"),outputSection.classList.add("hidden"),systemInfoContainer.classList.remove("hidden"),closStatsAbsolute.classList.add("hidden"),blockUpdateMessages(!1),updateExecutionStatus(!1),fallbackAttempts={}}