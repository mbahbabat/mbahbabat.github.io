let invalidEmails=[],validEmails=[];const emailWorker=new Worker(`${assetsBasePath}/js/main/E-SANITIZER.js`);function inputLineNumbersScroll(){lineNumbers.scrollTop=emailInput.scrollTop}function updateInputLineNumbers(){const e=emailInput.value.split("\n").length;if(e>2e3)return textareaContainer.style.cssText="flex-direction: column",lineNumbers.style.cssText="height: 50px;align-items: center;justify-content: center;padding:10px;margin:0;border: 1px solid red",void(lineNumbers.innerHTML=`<div style="font-size: 1.2em; color: #fff; font-style: italic; animation: blink-animation 2s infinite"> TOTAL: <strong style="font-weight; bold"> ${e} </strong>EMAILS </div>`);textareaContainer.style.cssText="",lineNumbers.style.cssText="",lineNumbers.innerHTML="";for(let t=1;t<=e;t++){const e=document.createElement("div");e.textContent=t,lineNumbers.appendChild(e)}inputLineNumbersScroll()}function handlePaste(){navigator.clipboard.readText().then((e=>{emailInput.value=e,validateInput(),emailInput.scrollTop=emailInput.scrollHeight})).catch((e=>{console.error("Failed to read clipboard contents: ",e),alert("Failed to paste from clipboard. Please paste manually.")}))}function handleFileUpload(e){const t=e.target.files[0];if(!t)return;const s=new FileReader;s.onload=function(e){emailInput.value=e.target.result,validateInput(),emailInput.scrollTop=emailInput.scrollHeight,fileInput.value=""},s.readAsText(t)}function clearInput(){emailInput.value="",validateInput()}function validateInput(){systemMessageBlocked||isExecution||(executeBtn.style.cssText="",systemMessage.style.cssText="",setTimeout((()=>{systemMessageBlocked||isExecution||(isLangID?systemMessage.textContent="Memvalidasi format email...":systemMessage.textContent="Validating email format...")}),1),setTimeout((()=>{systemMessageBlocked||isExecution||(systemMessage.textContent="")}),500),emailWorker.postMessage(emailInput.value),updateInputLineNumbers())}function addGmailDomain(){let e=emailInput.value.trim().split(/\s+/).map((e=>{if(e.toLowerCase().endsWith("@gmail.com"))return e;return/^[a-zA-Z0-9.]+$/.test(e)?e+"@gmail.com":e}));emailInput.value="",emailInput.value=e.join("\n"),validateInput()}function toggleErrorBtn(){invalidEmails.length>0?setTimeout((()=>{executeBtn.disabled=!0,pasteBtn.disabled=!0,uploadBtn.disabled=!0,clearInputBtn.classList.add("hidden"),clearErrorsBtn.classList.remove("hidden")}),550):setTimeout((()=>{executeBtn.disabled=!1,pasteBtn.disabled=!1,uploadBtn.disabled=!1,clearInputBtn.classList.remove("hidden"),clearErrorsBtn.classList.add("hidden")}),600)}emailWorker.onmessage=function(e){const{validEmails:t,invalidEmails:s}=e.data;validEmails=t,invalidEmails=s,validEmails.length>=1&&0===invalidEmails.length&&!systemMessageBlocked?executeBtn.style.cssText="animation: blink-animation 1s infinite":executeBtn.style.cssText="",displayErrors()},emailWorker.onerror=function(e){console.error("Web Worker Error:",e),isLangID?systemMessage.textContent="KESALAHAN: Validasi email gagal. Silakan coba lagi.":systemMessage.textContent="ERROR: Email validation failed. Please try again.",systemMessage.style.cssText="font-size: 0.8em; color: #ff0000; font-style: italic;",executeBtn.style.cssText=""};let messageInterval=null;function displayErrors(){systemMessageBlocked||isExecution||(messageInterval&&(clearInterval(messageInterval),messageInterval=null),invalidEmails.length>0?(toggleErrorBtn(),setTimeout((()=>{systemMessageBlocked||isExecution||(errorList.innerHTML="",errorInfo.classList.remove("hidden"),systemMessage.style.cssText="",isLangID?systemMessage.textContent=`${invalidEmails.length} terdeteksi format email tidak valid `:systemMessage.textContent=`${invalidEmails.length} invalid email format detected`,invalidEmails.forEach((e=>{const t=document.createElement("p"),s=document.createTextNode(`Line ${e.lineNumber}: ${e.text} - `);t.appendChild(s);const a=document.createElement("span");a.style.color=e.color,a.textContent=e.message,t.appendChild(a),errorList.appendChild(t)})))}),550)):(toggleErrorBtn(),setTimeout((()=>{if(0===emailInput.value.trim().length){if(systemMessageBlocked)return;if(isExecution)return;return errorList.innerHTML="",errorInfo.classList.add("hidden"),systemMessage.style.cssText="",void(isLangID?systemMessage.textContent="MASUKKAN MINIMAL 1 ALAMAT GMAIL":systemMessage.textContent="ENTER AT LEAST 1 VALID GMAIL ADDRESS")}systemMessageBlocked||isExecution||(errorList.innerHTML="",errorInfo.classList.add("hidden"),systemMessage.style.cssText="font-size: 0.8em;animation: blink-animation 3s infinite alternate ease-in-out; color: #ffff00;font-style:italic",isLangID?systemMessage.innerHTML='<p><i class="fa-solid fa-circle-exclamation"></i> PERHATIAN:</p><p>"Aplikasi ini masih dalam pengembangan;</p><p>harap hubungi @mbahbabat jika Kamu menemukan bug."</p>':systemMessage.innerHTML='<p><i class="fa-solid fa-circle-exclamation"></i> ATTENTION:</p><p>This application is still under development;</p><p>please report to @mbahbabat if you find any bugs.</p>')}),600),messageInterval=setInterval((()=>{systemMessageBlocked||isExecution}),5e3)))}async function clearErrors(){emailInput.value=validEmails.join("\n"),invalidEmails=[],errorList.innerHTML="",toggleErrorBtn(),validateInput()}
