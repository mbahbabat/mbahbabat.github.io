let myAccountModal=null;function createMyAccountModal(){return new Promise((e=>{let t;myAccountModal&&myAccountModal.remove(),myAccountModal=document.createElement("div"),myAccountModal.id="my-account-modal",myAccountModal.className="modal",t=isLangID?' <div class="modal-content"> <div class="modal-header"> <h2>AKUN SAYA</h2> </div> <div class="modal-body"> \x3c!-- Bagian Foto Profil --\x3e <div class="profile-picture-section"> <div class="profile-picture-container"> <div id="profile-picture-placeholder" class="profile-picture-placeholder"> <i class="fas fa-user"></i> </div> <img id="profile-picture" class="profile-picture hidden" alt="Foto Profil"> <div class="profile-upload-btn" id="profile-upload-btn" title="Ubah Foto Profil"> <i class="fas fa-camera"></i> </div> <input type="file" id="profile-picture-input" accept="image/*" class="hidden"> </div> </div> \x3c!-- Bagian Nama Pengguna --\x3e <div class="user-name-section"> <div id="user-name-display" class="user-name-display hidden"> <span id="display-user-name"></span> <button class="btn edit-user-name-btn" id="edit-user-name-btn" title="Edit Nama"> <i class="fas fa-edit"></i> </button> </div> <div id="user-name-form" class="user-name-form"> <input type="text" id="user-name-input" placeholder="Masukkan nama Kamu" maxlength="50" style="padding: 10px;"> <button class="btn save-user-name-btn" id="save-user-name-btn">SIMPAN</button> </div> </div> <div class="api-key-section" id="api-key-display"> <h3 style="display: flex; justify-content: space-between"> <span> KUNCI API<i class="fa-solid fa-circle-info apidocs-info-container" style="margin-left: 10px"><a href="../api-docs" target="_blank" class="apidocs-info">Pelajari dokumentasi API </a></i></span></h3> <div class="api-key-display"> <div class="api-key-value" id="api-key-value">Memuat...</div> <button class="btn copy-api-key" id="copy-api-key-btn"> <i class="fas fa-copy"></i> SALIN </button> </div> </div> <div class="stats-section" id="stats-section"> <h3>STATISTIK API</h3> <div id="modal-stats-container"> <p>Memuat statistik...</p> </div> </div> <div class="history-section"> <h3 style="display: flex; justify-content: space-between"> <span>RIWAYAT<i class="fa-solid fa-circle-info history-storage-info-container" style="margin-left: 10px"><span class="history-storage-info">RIWAYAT KAMU AKAN DISIMPAN DALAM PENYIMPANAN DB TERINDEKS DI DALAM BROWSER KAMU. KAMI TIDAK PERNAH MENGUMPULKAN DATA KAMU.</span></i></span> <i class="fa-solid fa-expand" id="expand-history" style="cursor: pointer;" title="Maksimalkan"></i> <i class="fa-solid fa-xmark hidden" id="minimize-history" style="cursor: pointer;" title="Pulihkan ke bawah"></i> </h3> <div class="history-stats"> <div class="history-stat" id="total-checks">Riwayat: 0</div> <div class="history-stat" id="total-emails">Gmail: 0</div> </div> <div class="history-list" id="history-list"> \x3c!-- Item riwayat akan dimuat di sini --\x3e </div> <button class="btn clear-history-btn" id="clear-all-history"> <i class="fas fa-broom"></i> HAPUS SEMUA RIWAYAT </button> </div> </div> <div class="modal-footer"> <button class="btn close-modal" id="close-my-account-modal"> <i class="fas fa-times"></i> TUTUP </tombol> </div> </div>':' <div class="modal-content"> <div class="modal-header"> <h2>MY ACCOUNT</h2> </div> <div class="modal-body"> \x3c!-- Profile Picture Section --\x3e <div class="profile-picture-section"> <div class="profile-picture-container"> <div id="profile-picture-placeholder" class="profile-picture-placeholder"> <i class="fas fa-user"></i> </div> <img id="profile-picture" class="profile-picture hidden" alt="Profile Picture"> <div class="profile-upload-btn" id="profile-upload-btn" title="Change Profile Picture"> <i class="fas fa-camera"></i> </div> <input type="file" id="profile-picture-input" accept="image/*" class="hidden"> </div> </div> \x3c!-- User Name Section --\x3e <div class="user-name-section"> <div id="user-name-display" class="user-name-display hidden"> <span id="display-user-name"></span> <button class="btn edit-user-name-btn" id="edit-user-name-btn" title="Edit Name"> <i class="fas fa-edit"></i> </button> </div> <div id="user-name-form" class="user-name-form"> <input type="text" id="user-name-input" placeholder="Enter your name" maxlength="50" style="padding: 10px;"> <button class="btn save-user-name-btn" id="save-user-name-btn">SAVE</button> </div> </div> <div class="api-key-section" id="api-key-display"> <h3 style="display: flex; justify-content: space-between"> <span> API KEY<i class="fa-solid fa-circle-info apidocs-info-container" style="margin-left: 10px"><a href="../api-docs" target="_blank" class="apidocs-info">Learn API documentation </a></i></span></h3> <div class="api-key-display"> <div class="api-key-value" id="api-key-value">Loading...</div> <button class="btn copy-api-key" id="copy-api-key-btn"> <i class="fas fa-copy"></i> COPY </button> </div> </div> <div class="stats-section" id="stats-section"> <h3>API STATISTICS</h3> <div id="modal-stats-container"> <p>Loading statistics...</p> </div> </div> <div class="history-section"> <h3 style="display: flex; justify-content: space-between"> <span>HISTORY<i class="fa-solid fa-circle-info history-storage-info-container" style="margin-left: 10px"><span class="history-storage-info">YOUR HISTORY WILL BE SAVED IN INDEXED DB STORAGE WITHIN YOUR BROWSER. WE NEVER COLLECT YOUR DATA.</span></i></span> <i class="fa-solid fa-expand" id="expand-history" style="cursor: pointer;" title="Maximize"></i> <i class="fa-solid fa-xmark hidden" id="minimize-history" style="cursor: pointer;" title="Restore down"></i> </h3> <div class="history-stats"> <div class="history-stat" id="total-checks">History: 0</div> <div class="history-stat" id="total-emails">Gmails: 0</div> </div> <div class="history-list" id="history-list"> \x3c!-- History items will be loaded here --\x3e </div> <button class="btn clear-history-btn" id="clear-all-history"> <i class="fas fa-broom"></i> CLEAR ALL HISTORY </button> </div> </div> <div class="modal-footer"> <button class="btn close-modal" id="close-my-account-modal"> <i class="fas fa-times"></i> CLOSE </button> </div> </div> ',myAccountModal.innerHTML=t,document.body.appendChild(myAccountModal),document.getElementById("close-my-account-modal").addEventListener("click",(()=>{closeMyAccountModal(),backToMain()})),document.getElementById("copy-api-key-btn").addEventListener("click",copyApiKey),document.getElementById("clear-all-history").addEventListener("click",clearAllHistoryUI),document.getElementById("profile-picture-placeholder").addEventListener("click",triggerProfilePictureUpload),document.getElementById("profile-picture").addEventListener("click",triggerProfilePictureUpload),document.getElementById("profile-upload-btn").addEventListener("click",triggerProfilePictureUpload),document.getElementById("profile-picture-input").addEventListener("change",handleProfilePictureUpload),document.getElementById("save-user-name-btn").addEventListener("click",saveUserName),document.getElementById("edit-user-name-btn").addEventListener("click",editUserName),document.getElementById("user-name-input").addEventListener("keydown",(e=>{"Enter"===e.key&&saveUserName()})),document.getElementById("expand-history").addEventListener("click",(()=>{document.getElementById("api-key-display").classList.add("hidden"),document.getElementById("stats-section").classList.add("hidden"),document.getElementById("minimize-history").classList.remove("hidden"),document.getElementById("expand-history").classList.add("hidden")})),document.getElementById("minimize-history").addEventListener("click",(()=>{document.getElementById("api-key-display").classList.remove("hidden"),document.getElementById("stats-section").classList.remove("hidden"),loadUserName(),document.getElementById("minimize-history").classList.add("hidden"),document.getElementById("expand-history").classList.remove("hidden")})),document.getElementById("profile-picture").addEventListener("contextmenu",(e=>{e.preventDefault(),deleteProfilePicture()})),document.getElementById("profile-picture-placeholder").addEventListener("contextmenu",(e=>{e.preventDefault(),deleteProfilePicture()})),myAccountModal.addEventListener("click",(e=>{e.target===myAccountModal&&closeMyAccountModal()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&"flex"===myAccountModal.style.display&&closeMyAccountModal()})),setTimeout((()=>e()),0)}))}function checkModalElements(){["history-list","total-checks","total-emails","modal-stats-container","api-key-value","user-name-input","display-user-name"].forEach((e=>{document.getElementById(e)}))}async function showMyAccountModal(){try{myAccountModal||await createMyAccountModal(),myAccountModal.classList.remove("hidden"),checkModalElements(),await loadProfilePicture(),await loadUserName(),await loadApiKeyData(),await loadStatsDataModal(),await initHistorySystem(),await loadHistory()}catch(e){console.error("Error showing My Account modal:",e)}}function closeMyAccountModal(){if(myAccountModal){myAccountModal.classList.add("hidden");const e=document.getElementById("modal-countdown");e&&e.dataset.intervalId&&(clearInterval(parseInt(e.dataset.intervalId)),e.dataset.intervalId=null),document.getElementById("api-key-display").classList.remove("hidden"),document.getElementById("stats-section").classList.remove("hidden"),document.getElementById("minimize-history").classList.add("hidden"),document.getElementById("expand-history").classList.remove("hidden")}}async function loadApiKeyData(){if(!APIKEY){const e=await handleGenerateKey();APIKEY=e.APIKEY}try{const e=document.getElementById("api-key-value");if(e)if(e.textContent="Retrieving API key...",APIKEY&&APIKEY.length>16){const t=APIKEY.substring(0,8)+"â€¢".repeat(16)+APIKEY.substring(APIKEY.length-8);e.textContent=t,e.dataset.fullKey=APIKEY}else e.textContent="Failed to load API key"}catch(e){console.error("Error loading API key:",e);const t=document.getElementById("api-key-value");t&&(t.textContent="Error loading API key")}}async function loadStatsDataModal(){try{const e=document.getElementById("modal-stats-container");if(!e)return console.error("Stats container not found");e.innerHTML="<p>Loading statistics...</p>";const t=await getApiStatsData();if(!t)return e.innerHTML='<p class="status-error">Failed to load statistics</p>';renderApiStats(t,!0)}catch(e){console.error("Error loading stats in modal:",e);const t=document.getElementById("modal-stats-container");t&&(t.innerHTML='<p class="status-error">Error loading statistics</p>')}}function copyApiKey(){const e=document.getElementById("api-key-value").dataset.fullKey;e?navigator.clipboard.writeText(e).then((()=>{const e=document.getElementById("copy-api-key-btn"),t=e.innerHTML;isLangID?e.innerHTML='<i class="fas fa-check"></i> TERSALIN!':e.innerHTML='<i class="fas fa-check"></i> COPIED!',e.style.backgroundColor="var(--secondary-orange)",setTimeout((()=>{e.innerHTML=t,e.style.backgroundColor=""}),2e3)})).catch((e=>{console.error("Failed to copy API key: ",e),alert("Failed to copy API key to clipboard")})):alert("API key not available")}async function loadProfilePicture(){try{const e=document.getElementById("my-account-button"),t=await getProfilePictureFromDB();t?(updateProfilePictureUI(t),e.innerHTML=`<img src="${t}" class="header-profile-pic" alt="Profile">`):(e.innerHTML='<i class="fa-regular fa-user"></i>',updateProfilePictureUI(null))}catch(e){console.error("Error loading profile picture:",e),document.getElementById("my-account-button").innerHTML='<i class="fa-regular fa-user"></i>'}}function updateProfilePictureUI(e){const t=document.getElementById("profile-picture"),i=document.getElementById("profile-picture-placeholder");e&&t&&i?(t.src=e,t.classList.remove("hidden"),i.classList.add("hidden")):t&&i&&(t.classList.add("hidden"),i.classList.remove("hidden"))}function triggerProfilePictureUpload(){document.getElementById("profile-picture-input").click()}function handleProfilePictureUpload(e){const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return alert("Please select a valid image file.");if(t.size>5242880)return alert("Image size should be less than 5MB.");const i=new FileReader;i.onload=function(e){const t=e.target.result;saveProfilePictureToDB(t),updateProfilePictureUI(t),document.getElementById("my-account-button").innerHTML=`<img src="${t}" class="header-profile-pic" alt="Profile">`},i.readAsDataURL(t),e.target.value=""}async function saveProfilePictureToDB(e){return new Promise(((t,i)=>{const a=indexedDB.open("GmailCheckerProfile",1);a.onerror=()=>i(a.error),a.onsuccess=()=>{const s=a.result.transaction(["profile"],"readwrite").objectStore("profile"),n={id:"profilePicture",data:e,timestamp:Date.now()},o=s.put(n);o.onsuccess=()=>t(),o.onerror=()=>i(o.error)},a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("profile")||t.createObjectStore("profile",{keyPath:"id"})}}))}async function getProfilePictureFromDB(){return new Promise(((e,t)=>{const i=indexedDB.open("GmailCheckerProfile",1);i.onerror=()=>t(i.error),i.onsuccess=()=>{const a=i.result.transaction(["profile"],"readonly").objectStore("profile").get("profilePicture");a.onsuccess=()=>{a.result?e(a.result.data):e(null)},a.onerror=()=>t(a.error)},i.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("profile")||t.createObjectStore("profile",{keyPath:"id"})}}))}async function deleteProfilePictureFromDB(){return new Promise(((e,t)=>{const i=indexedDB.open("GmailCheckerProfile",1);i.onerror=()=>t(i.error),i.onsuccess=()=>{const a=i.result.transaction(["profile"],"readwrite").objectStore("profile").delete("profilePicture");a.onsuccess=()=>e(),a.onerror=()=>t(a.error)},i.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("profile")||t.createObjectStore("profile",{keyPath:"id"})}}))}async function deleteProfilePicture(){if(confirm("Are you sure you want to remove your profile picture?"))try{await deleteProfilePictureFromDB(),updateProfilePictureUI(null),document.getElementById("my-account-button").innerHTML='<i class="fa-regular fa-user"></i>'}catch(e){console.error("Error deleting profile picture:",e),alert("Failed to delete profile picture.")}}async function saveUserName(){const e=document.getElementById("user-name-input").value.trim();e?(localStorage.setItem("userName",e),updateUserNameUI(e)):isLangID?alert("Silakan masukkan nama."):alert("Please enter a name.")}async function loadUserName(){updateUserNameUI(localStorage.getItem("userName"))}function updateUserNameUI(e){const t=document.getElementById("user-name-display"),i=document.getElementById("display-user-name"),a=document.getElementById("user-name-form"),s=document.getElementById("user-name-input");e?(i.textContent=e,t.classList.remove("hidden"),a.classList.add("hidden")):(t.classList.add("hidden"),a.classList.remove("hidden"),s.value="")}function editUserName(){const e=localStorage.getItem("userName"),t=document.getElementById("user-name-display"),i=document.getElementById("user-name-form"),a=document.getElementById("user-name-input");t.classList.add("hidden"),i.classList.remove("hidden"),a.value=e||"",a.focus()}loadProfilePicture();