const server1=`${SERVER_URL}/check1`,server2=`${SERVER_URL}/check2`,server3=`${SERVER_URL}/check3`,fastServer=`${SERVER_URL}/fastcheck`;let abortController=null,selectedMode="normal",chunks=[],currentProgress=0;async function EXECUTE(){if(blockUpdateMessages(!0),!APIKEY){systemMessage.innerHTML="<p>GENERATING API KEY</p><p>PLEASE WAIT...</p>",executeBtn.disabled=!0,clearInputBtn.disabled=!0,pasteBtn.disabled=!0,uploadBtn.disabled=!0,executeBtn.innerHTML='<div class="loading-spinner"></div>';try{const e=await handleGenerateKey();APIKEY=e.APIKEY}catch(e){throw handleSystemError(),systemMessage.textContent="ERROR: FAILED TO GENERATE API KEY. PLEASE TRY AGAIN.",console.error("Failed to get API Key:",e),new Error("Failed to initialize API key for execution.")}executeBtn.disabled=!1,clearInputBtn.disabled=!1,pasteBtn.disabled=!1,uploadBtn.disabled=!1,executeBtn.innerHTML="",executeBtn.innerHTML='<i class="fas fa-play"></i> EXECUTE'}if(await validateInput(),invalidEmails.length>0)return;emailInput.value=validEmails.join("\n");const e=emailInput.value.split("\n").map((e=>e.trim())).filter((e=>e.length>0));if(0===e.length)return;progressOverlay.classList.remove("hidden"),executeBtn.disabled=!0,inputButtonContainer.classList.add("hidden"),inputSection.classList.add("hidden"),outputSection.classList.remove("hidden"),errorInfo.classList.add("hidden");let t,r,s=setTimeout((()=>{stopButttonContainer.classList.remove("hidden")}),2e4);"normal"===selectedMode?(t=100,r=[server1,server2,server3]):"fast"===selectedMode&&(t=1e4,r=[fastServer]),chunks=[];for(let r=0;r<e.length;r+=t)chunks.push(e.slice(r,r+t));results=[],abortController=new AbortController,currentProgress=0,updateProgressBar(0),systemMessage.textContent="INITIALIZING...";try{if("normal"===selectedMode?await processChunksWithFallback(chunks,r):await processChunks(chunks,r[0]),abortController.signal.aborted)throw clearTimeout(s),new Error("Aborted by user.");clearTimeout(s),await animateProgressBar(currentProgress,100),progressOverlay.classList.add("hidden"),stopButttonContainer.classList.add("hidden"),outputButtonContainer.classList.remove("hidden"),apiStats.classList.remove("hidden"),systemMessage.textContent="EXECUTION COMPLETED!",await saveCurrentResults(),await updateApiStatsAfterExecution(results.length),updateCounters(),resultListContainer.scrollTop=0,displayResults()}catch(e){clearTimeout(s),"EXECUTION CANCELLED"===e.name||"Aborted by user."===e.message||(console.error("Execution error:",e),stopButttonContainer.classList.add("hidden"),handleSystemError(),systemMessage.textContent=`${e.message}`)}}async function processChunksWithFallback(e,t){if(abortController.signal.aborted)return;if(!APIKEY)try{const e=await handleGenerateKey();APIKEY=e.APIKEY}catch(e){if("EXECUTION CANCELLED"===e.name)throw e;throw console.error("Failed to get API Key:",e),new Error("Failed to initialize API key for execution.")}for(let r=0;r<e.length;r++){if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");const s=e[r],o=(r+1)/e.length*100;let a=!1;for(let e=0;e<t.length;e++){const n=t[e];try{const e=await fetchWithTimeout(n,{method:"POST",headers:{Authorization:`Bearer ${APIKEY}`,"Content-Type":"application/json"},body:JSON.stringify({mail:s})},25e3,abortController.signal);if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");if(processApiResponse(await e.json()),abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");if(updateCounters(),displayResults(),await animateProgressBar(currentProgress,o),abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");systemMessage.textContent=`PROCESSING... ${currentProgress.toFixed(0)}%`,a=!0;break}catch(s){if("EXECUTION CANCELLED"===s.name)throw s;if(console.warn(`Error with ${n} for chunk ${r+1}:`,s.message),e===t.length-1)throw new Error("FAILED TO CONNECT TO SERVER...")}}if(!a)throw new Error(`Failed to process chunk ${r+1} after trying all available servers.`);if(r<e.length-1&&(await new Promise((e=>setTimeout(e,10))),abortController.signal.aborted))throw new Error("EXECUTION CANCELLED")}}async function processChunks(e,t){if(abortController.signal.aborted)return;if(!APIKEY)try{const e=await handleGenerateKey();APIKEY=e.APIKEY}catch(e){if("EXECUTION CANCELLED"===e.name)throw e;throw console.error("Failed to get API Key:",e),new Error("Failed to initialize API key for execution.")}for(let r=0;r<e.length;r++){if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");const s=e[r],o=(r+1)/e.length*100;try{const e=await fetchWithTimeout(t,{method:"POST",headers:{Authorization:`Bearer ${APIKEY}`,"Content-Type":"application/json"},body:JSON.stringify({mail:s})},25e3,abortController.signal);if(abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");if(processApiResponse(await e.json()),abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");if(updateCounters(),displayResults(),await animateProgressBar(currentProgress,o),abortController.signal.aborted)throw new Error("EXECUTION CANCELLED");systemMessage.textContent=`PROCESSING... ${currentProgress.toFixed(0)}%`}catch(e){if("EXECUTION CANCELLED"===e.name)throw e;throw console.error(`Error in processChunks with ${t}:`,e),e}if(r<e.length-1&&(await new Promise((e=>setTimeout(e,10))),abortController.signal.aborted))throw new Error("EXECUTION CANCELLED")}}function fetchWithTimeout(e,t,r,s){return new Promise(((o,a)=>{const n=new AbortController,i=setTimeout((()=>{n.abort(),a(new Error("Request timeout"))}),r);s&&s.addEventListener("abort",(()=>{clearTimeout(i),n.abort(),a(new Error("EXECUTION CANCELLED"))}),{once:!0}),t.signal=n.signal,fetch(e,t).then((e=>{clearTimeout(i),o(e)})).catch((e=>{clearTimeout(i),a(e)}))}))}function processApiResponse(e){abortController&&abortController.signal.aborted||(Array.isArray(e)?e.forEach((e=>{let t=e.status;t="Error"===t?"error":"error"===t||"Disabled"===t||"disabled"===t?"disabled":"Live"===t||"live"===t?"live":"Verify"===t||"verify"===t?"verify":"Unregistered"===t||"unregistered"===t?"unregistered":"error",results.push({email:e.email,status:t,details:e.details||"Validated"})})):console.error("Invalid API response:",e))}function cancelExecution(){abortController&&(abortController.abort(),stopButttonContainer.classList.add("hidden"),handleSystemError(),systemMessage.textContent="EXECUTION CANCELLED")}function updateProgressBar(e){const t=Math.min(100,Math.max(0,e));donutChart.style.background=`conic-gradient(#cc0000 ${t}%, #333 ${t}% 100%)`,progressText.textContent=`${t.toFixed(0)}%`}async function animateProgressBar(e,t){const r=10*Math.abs(t-e),s=performance.now();return new Promise((o=>{requestAnimationFrame((function a(n){const i=n-s,l=Math.min(1,i/r),d=e+(t-e)*l;updateProgressBar(d),currentProgress=d,l<1&&!abortController.signal.aborted?requestAnimationFrame(a):(updateProgressBar(t),currentProgress=t,o())}))}))}function handleSystemError(){createLoadingAnimation(duration="fast"),executeBtn.disabled=!1,inputSection.classList.remove("hidden"),inputButtonContainer.classList.remove("hidden"),outputSection.classList.add("hidden"),outputButtonContainer.classList.add("hidden"),progressOverlay.classList.add("hidden"),apiStats.classList.add("hidden"),results=[],currentFilter="all",filterBtns.forEach((e=>{e.classList.remove("active"),"all"===e.dataset.filter&&e.classList.add("active")})),resultList.innerHTML="",resultList.style.height="auto",resultListContainer.scrollTop=0,updateProgressBar(0),validateInput(),updateInputLineNumbers(),blockUpdateMessages(!1),systemMessage.textContent="SYSTEM HAS BEEN RESET."}function resetSystem(){createLoadingAnimation(duration="fast"),executeBtn.disabled=!1,inputSection.classList.remove("hidden"),inputButtonContainer.classList.remove("hidden"),outputSection.classList.add("hidden"),outputButtonContainer.classList.add("hidden"),progressOverlay.classList.add("hidden"),apiStats.classList.add("hidden"),clearInput(),results=[],currentFilter="all",filterBtns.forEach((e=>{e.classList.remove("active"),"all"===e.dataset.filter&&e.classList.add("active")})),resultList.innerHTML="",resultList.style.height="auto",resultListContainer.scrollTop=0,updateProgressBar(0),validateInput(),updateInputLineNumbers(),blockUpdateMessages(!1),systemMessage.textContent="SYSTEM HAS BEEN RESET."}