let myAccountModal=null;function createMyAccountModal(){return new Promise((t=>{myAccountModal&&myAccountModal.remove(),myAccountModal=document.createElement("div"),myAccountModal.id="my-account-modal",myAccountModal.className="modal",myAccountModal.innerHTML=' <div class="modal-content"> <div class="modal-header"> <h2>MY ACCOUNT</h2> </div> <div class="modal-body"> <div class="api-key-section"> <h3>YOUR API KEY</h3> <div class="api-key-display"> <div class="api-key-value" id="api-key-value">Loading...</div> <button class="btn copy-api-key" id="copy-api-key-btn"> <i class="fas fa-copy"></i> COPY </button> </div> </div> <div class="stats-section"> <h3>API STATISTICS</h3> <div id="modal-stats-container"> <p>Loading statistics...</p> </div> </div> <div class="history-section"> <h3>HISTORY</h3> <div class="history-stats"> <div class="history-stat" id="total-checks">Total: 0</div> <div class="history-stat" id="total-emails">Emails: 0</div> </div> <div class="history-list" id="history-list"> \x3c!-- History items will be loaded here --\x3e </div> <button class="btn clear-history-btn" id="clear-all-history"> <i class="fas fa-broom"></i> CLEAR ALL HISTORY </button> </div> </div> <div class="modal-footer"> <button class="btn close-modal" id="close-my-account-modal"> <i class="fas fa-times"></i> CLOSE </button> </div> </div> ',document.body.appendChild(myAccountModal),document.getElementById("close-my-account-modal").addEventListener("click",(function(){closeMyAccountModal(),backToMain()})),document.getElementById("copy-api-key-btn").addEventListener("click",copyApiKey),document.getElementById("clear-all-history").addEventListener("click",clearAllHistoryUI),myAccountModal.addEventListener("click",(function(t){t.target===myAccountModal&&closeMyAccountModal()})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&"flex"===myAccountModal.style.display&&closeMyAccountModal()})),setTimeout((()=>t()),0)}))}function checkModalElements(){["history-list","total-checks","total-emails","modal-stats-container","api-key-value"].forEach((t=>{document.getElementById(t)}))}async function showMyAccountModal(){try{myAccountModal||await createMyAccountModal(),myAccountModal.classList.remove("hidden"),checkModalElements(),await loadApiKeyData(),await loadStatsDataModal(),await initHistorySystem(),await loadHistory()}catch(t){console.error("Error showing My Account modal:",t)}}function closeMyAccountModal(){if(myAccountModal){myAccountModal.classList.add("hidden");const t=document.getElementById("modal-countdown");t&&t.dataset.intervalId&&(clearInterval(parseInt(t.dataset.intervalId)),t.dataset.intervalId=null)}}async function loadApiKeyData(){if(!APIKEY){const t=await handleGenerateKey();APIKEY=t.APIKEY}try{const t=document.getElementById("api-key-value");if(t.textContent="Retrieving API key...",APIKEY&&APIKEY.length>16){const a=APIKEY.substring(0,8)+"â€¢".repeat(16)+APIKEY.substring(APIKEY.length-8);t.textContent=a,t.dataset.fullKey=APIKEY}else t.textContent="Failed to load API key"}catch(t){console.error("Error loading API key:",t),document.getElementById("api-key-value").textContent="Error loading API key"}}async function loadStatsDataModal(){try{const t=document.getElementById("modal-stats-container");if(!t)return void console.error("Stats container not found");t.innerHTML="<p>Loading statistics...</p>";const a=await getApiStatsData();if(!a)return void(t.innerHTML='<p class="status-error">Failed to load statistics</p>');renderApiStats(a,!0)}catch(t){console.error("Error loading stats in modal:",t);const a=document.getElementById("modal-stats-container");a&&(a.innerHTML='<p class="status-error">Error loading statistics</p>')}}function copyApiKey(){const t=document.getElementById("api-key-value").dataset.fullKey;t?navigator.clipboard.writeText(t).then((()=>{const t=document.getElementById("copy-api-key-btn"),a=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i> COPIED!',t.style.backgroundColor="var(--secondary-orange)",setTimeout((()=>{t.innerHTML=a,t.style.backgroundColor=""}),2e3)})).catch((t=>{console.error("Failed to copy API key: ",t),alert("Failed to copy API key to clipboard")})):alert("API key not available")}