import{initializeApp}from"https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";import{getAuth,signInAnonymously,onAuthStateChanged,GoogleAuthProvider,getRedirectResult,signInWithPopup,signInWithRedirect,signOut}from"https://www.gstatic.com/firebasejs/11.3.0/firebase-auth.js";import{getDatabase,push,onValue,serverTimestamp,query,limitToLast,ref,set,get,update,remove,onDisconnect,child,orderByKey,startAfter,endBefore,orderByChild,equalTo,off,startAt,endAt,limitToFirst,onChildAdded,increment}from"https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";const cosecs=bstx(h3tx(h3tx(bstx("MzYzNTM3MzkzNDYxMzYzODM2MzMzNDM3MzY2MzM0NjMzNTYxMzUzODM2NjIzNjM5MzQ2NjM2MzkzNDYxMzQzMjM1MzMzNTM4MzczMDM2MzgzNTM1MzMzMzM2NjMzNDMyMzUzMjMzMzEzNjM3MzczNDM1NjEzNTM3MzYzODM0MzczNDY1MzUzODM0MzIzNTM1MzUzOTMzMzMzNzMwMzUzNzM1NjEzNjYxMzUzNjM3MzkzNTMzMzQzNDM1NjEzMzMwMzUzMTM1MzUzNzM4MzQ2NDM1MzYzMzMzMzQzMjM0MzUzNjMxMzQzNjM0MzkzNzYxMzUzMzM2NjQzNjYzMzMzNDM1MzIzNjYyMzUzNTM2MzkzNDYzMzQzMzM0NjEzNjM4MzYzNDM1MzgzNTMyMzY2NjM1MzIzNDM3MzMzOTM3MzQzNTM5MzUzNzM2NjMzNzM1MzQzOTM2NjEzNjY2MzYzOTM2MzQzMzMyMzUzNjM2MzkzNDYzMzUzNzM0MzYzNzM1MzUzOTM1MzczNzM4MzMzNTM2MzQzNDM3MzY2MzM2NjEzNjMzMzczOTMzMzAzMzMyMzQ2NTMzMzIzNTYxMzYzOTM1NjEzNjM5MzMzNTM2NjQzNjMxMzUzODM0NjEzNjYzMzUzOTM2NjQzNDM2Mzc2MTM1NjEzNTM3MzQzNjM3MzczNjMzMzQzMzMzMzUzNjYxMzYzMjMzMzIzMzMwMzYzOTM0NjMzNDMzMzQ2MTM2NjIzNTM5MzUzODM1MzIzNjM4MzUzOTM2NjQzNDM2Mzc2MTM1NjEzNTM2MzUzNjM1MzMzNTM0MzQzMzM0MzkzMzM2MzQzOTM2NjQzNjM4MzMzMDM2MzQzNDM4MzQzMjM3NjEzNDY2MzYzOTMzMzgzNzM2MzYzNDMzMzIzNTM2MzYzOTM0NjMzNTM3MzQzNjM3MzUzNTM5MzUzNzM3MzgzMzM1MzYzNDM0MzczNjYzMzY2MTM2MzMzNzM5MzMzMDMzMzIzNDY1MzMzMjM1NjEzNjM5MzU2MTM2MzkzMzMxMzY2MjM1NjEzNTM3MzU2MTM2MzgzNjM0MzUzNzM3MzgzMzMwMzQ2MzM1MzgzNDYxMzMzMDM1NjEzNDM3MzQzOTM3MzUzNTM5MzUzODM0NjUzNzMwMzUzOTM1MzMzMzMxMzc2MTM2MzIzMzMzMzUzNjMzMzAzNjMxMzQzNzM1MzYzNjM4MzYzMzMzMzMzNTMxMzczODM0NjMzNjY0MzU2MTM3MzAzNjMzMzY2NDM1MzYzNjM5MzUzOTM1MzgzNDY1MzY2MzM1NjEzNDM3MzQzNjMzMzAzNTM5MzUzNzM0NjEzNjM4MzYzMzMzMzIzNTM1MzczNTM1MzkzNTM4MzQzMjM3MzczNDM5MzYzOTM3MzczNjM5MzYzMzM0MzgzNDYxMzczNjM2MzEzNjY0MzUzNjM2NjEzNjM0MzQzNTM2NjMzNjYyMzQzOTM2NjEzNjY2MzYzNzM0MzkzNjY1MzYzNDM2NjMzNTM5MzYzOTMzMzEzNjM4MzYzMjM2NjQzNDM2MzczMzM2MzUzNTM4MzUzMjM3MzAzNTM5MzMzMzM0NjQzNzM0MzQ2NTM2NjEzNjM0MzY2NDM1MzkzNjY0MzUzOTM2MzkzNDYzMzQzMzM0NjEzNzYxMzYzNDM0MzczMzM5MzczOTM1MzkzNTM3MzYzNDM2NjMzNTMxMzY2NTM1MzYzNjYxMzYzMTMzMzIzNTM2MzMzMDM0MzkzNjYxMzY2NjM2MzkzNjM0MzMzMjM1MzYzNjM5MzQ2MzM1MzczNDM2MzczNTM1MzkzNTM3MzczODMzMzUzNjM0MzQzNzM2NjMzNjYxMzYzMzM3MzkzMzMwMzMzMjM0NjUzMzMyMzU2MTM2MzkzNTYxMzYzOTMzMzUzNjY0MzYzMTM1MzgzNDYxMzY2MzM1MzkzNjY0MzQzNjM3NjEzNTYxMzUzODM0NjUzMzMwMzYzMjMzMzMzNDYxMzYzODM1NjEzMzMyMzUzNTM3MzUzNTM5MzUzODM0MzIzNzM3MzQzOTM2MzkzNzM3MzYzOTM2MzIzNTM3MzUzNjM3NjEzNjMzMzMzMjM0MzYzNjY1MzYzMTM1MzczMzM1MzY2NTM1MzUzMzMyMzUzNjM3MzUzNTYxMzQzNzM1MzYzNzM5MzUzMzM1MzczNTMxMzYzOTM0NjYzNjM5MzQzOTMzMzIzNDY0MzQzNDM0NjQzMzM0MzQ2NjM0MzQzNTMxMzMzNDM0NjYzNTM0MzQzMTMzMzUzNDY0MzY2MTM1MzkzNjM5MzQ2MzM0MzMzNDYxMzYzODM2MzMzNDM4MzQzMjM0NjEzNTYxMzQzMzM0MzkzMzM2MzQzOTM2NjEzNDM1MzMzNjM0NjUzNjYxMzQzMTM3NjEzNDY2MzQzNDM2MzczMzMwMzQ2NjM0MzQzNjYyMzczNzM0NjYzNTM0MzQzOTMzMzIzNDY2MzY2NTM2MzQzNjYzMzUzOTM2NjEzNzMwMzY2MjM0NjYzNTM3MzUzOTM3MzkzNDY0MzQzNzM1MzEzMzMwMzUzOTMzMzIzNTMxMzczOTM1NjEzNjYxMzUzOTM3NjEzNDY2MzUzNzM1MzYzNjYzMzUzOTM1MzQzNDYxMzY2MzM0NjYzNDM3MzQ2MTM2NjQzNDM5MzYzOTM3MzczNjM5MzYzMjM1MzczNTM2MzYzODM2MzMzMzMzMzUzNjM3MzkzNTYxMzUzNzMzMzEzNjYzMzYzMjM2NjUzNTMyMzQ2MTM1NjEzNDMzMzQzOTMzMzYzNDM5MzY2MjM2MzMzNzM0MzUzNTM3NjEzNDM2MzQ2NDM0NjYzNTM1MzMzNTM1MzMzNDY0MzY2MzM2NjYzMzMwMzUzNDM1MzMzNDYxMzMzOQ")))),cosec=JSON.parse(cosecs),analyticsApp=initializeApp(cosec),analyticsAuth=getAuth(analyticsApp),analyticsDb=getDatabase(analyticsApp);let currentUser=null;function generateRandom8Chars(){let z="";for(let M=0;M<8;M++)z+="0123456789".charAt(Math.floor(10*Math.random()));return z}async function generateCustomUid(z,M){const e="globalWebAnalytics/apps/gmail-checker",t=ref(analyticsDb,`${e}/ipToCustomUid/${sanitizeKey(z)}`),a=ref(analyticsDb,`${e}/firebaseUidToCustomUid/${M}`);try{const z=await get(t);if(z.exists())return z.val();const M=await get(a);if(M.exists())return M.val();let n=generateRandom8Chars(),i=ref(analyticsDb,`${e}/users/${n}`),s=!1,r=0;for(;!s&&r<10;)(await get(i)).exists()?(n=generateRandom8Chars(),i=ref(analyticsDb,`${e}/users/${n}`),r++):s=!0;if(!s)throw new Error("Gagal menghasilkan customUid unik setelah 10 percobaan.");return n}catch(z){throw console.error("Error in generateCustomUid:",z),z}}async function initApp(){try{await signInApp(),await setupAuthListener()}catch(z){console.error("Failed to initialize Firebase:",z)}}async function setupAuthListener(){onAuthStateChanged(analyticsAuth,(async z=>{currentUser=z,currentUser?await updateUserPresence():(currentUser=null,await signInApp())}))}async function signInApp(){let z=0;try{await signInAnonymously(analyticsAuth)}catch(M){z<3&&(z++,setTimeout((async()=>{await signInAnonymously(analyticsAuth)}),1e3))}}async function updateUserPresence(){try{const{ip:z,country:M,code:e}=await fetchLocationInfo(),t=sanitizeKey(z),a=(sanitizeKey(M),currentUser.uid),n="globalWebAnalytics/apps/gmail-dot-trick",i=await generateCustomUid(t,a),s=`users/${i}`,r=ref(analyticsDb,`${n}/${s}`),c=ref(analyticsDb,`${n}/ipToCustomUid/${t}`),N=ref(analyticsDb,`${n}/firebaseUidToCustomUid/${a}`);await set(c,i),await set(N,i);const o=!(await get(r)).exists(),u=Date.now(),l=sanitizeDate(),y=sanitizeWeek(),j=sanitizeMonth(),D=ref(analyticsDb,`${n}/${s}/IPHistory/${t}`),$=ref(analyticsDb,`${n}/${s}/FirebaseUIDHistory/${a}`);await set(D,{timestamp:u,countryCode:e}),await set($,{timestamp:u});const U=ref(analyticsDb,`${n}/${s}/UserPresence`),Y=await get(U);let T=!1;Y.exists()&&(u-(Y.val().userLastSeen||0))/6e4>=15&&!o&&(T=!0),await update(U,{status:"online",userLastSeen:u,LastIP:t,LastFirebaseUID:a});const w=`${n}/stats`,d=ref(analyticsDb,`${w}/uniqueUsers/daily/${l}/${i}`),p=ref(analyticsDb,`${w}/uniqueUsers/weekly/${y}/${i}`),f=ref(analyticsDb,`${w}/uniqueUsers/monthly/${j}/${i}`),g=ref(analyticsDb,`${w}/uniqueUsers/total/${i}`),[b,m,h,Q]=await Promise.all([get(d),get(p),get(f),get(g)]);b.exists()||(await set(d,!0),await update(ref(analyticsDb,`${w}/uniqueUsers/daily/${l}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/uniqueUsers/daily/${l}/country/${e}`),{count:increment(1)})),m.exists()||(await set(p,!0),await update(ref(analyticsDb,`${w}/uniqueUsers/weekly/${y}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/uniqueUsers/weekly/${y}/country/${e}`),{count:increment(1)})),h.exists()||(await set(f,!0),await update(ref(analyticsDb,`${w}/uniqueUsers/monthly/${j}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/uniqueUsers/monthly/${j}/country/${e}`),{count:increment(1)})),Q.exists()||(await set(g,!0),await update(ref(analyticsDb,`${w}/uniqueUsers/total/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/uniqueUsers/total/country/${e}`),{count:increment(1)})),o&&(await update(ref(analyticsDb,`${w}/newUsers/daily/${l}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/newUsers/daily/${l}/country/${e}`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/newUsers/weekly/${y}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/newUsers/weekly/${y}/country/${e}`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/newUsers/monthly/${j}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/newUsers/monthly/${j}/country/${e}`),{count:increment(1)}));const k=ref(analyticsDb,`${w}/onlineUsers/daily/${l}/${i}`),x=ref(analyticsDb,`${w}/onlineUsers/weekly/${y}/${i}`),O=ref(analyticsDb,`${w}/onlineUsers/monthly/${j}/${i}`),[E,A,I]=await Promise.all([get(k),get(x),get(O)]);E.exists()||(await set(k,!0),await update(ref(analyticsDb,`${w}/onlineUsers/daily/${l}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/onlineUsers/daily/${l}/country/${e}`),{count:increment(1)})),A.exists()||(await set(x,!0),await update(ref(analyticsDb,`${w}/onlineUsers/weekly/${y}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/onlineUsers/weekly/${y}/country/${e}`),{count:increment(1)})),I.exists()||(await set(O,!0),await update(ref(analyticsDb,`${w}/onlineUsers/monthly/${j}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/onlineUsers/monthly/${j}/country/${e}`),{count:increment(1)}));const C=ref(analyticsDb,`${w}/countries/daily/${l}/${e}/users/${i}`),_=ref(analyticsDb,`${w}/countries/weekly/${y}/${e}/users/${i}`),L=ref(analyticsDb,`${w}/countries/monthly/${j}/${e}/users/${i}`),S=ref(analyticsDb,`${w}/countries/total/${e}/users/${i}`),[q,v,P,F]=await Promise.all([get(C),get(_),get(L),get(S)]);if(q.exists()||(await set(C,!0),await update(ref(analyticsDb,`${w}/countries/daily/${l}/${e}`),{count:increment(1)})),v.exists()||(await set(_,!0),await update(ref(analyticsDb,`${w}/countries/weekly/${y}/${e}`),{count:increment(1)})),P.exists()||(await set(L,!0),await update(ref(analyticsDb,`${w}/countries/monthly/${j}/${e}`),{count:increment(1)})),F.exists()||(await set(S,!0),await update(ref(analyticsDb,`${w}/countries/total/${e}`),{count:increment(1)})),T&&(await update(ref(analyticsDb,`${w}/returningUsers/daily/${l}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/returningUsers/daily/${l}/country/${e}`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/returningUsers/weekly/${y}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/returningUsers/weekly/${y}/country/${e}`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/returningUsers/monthly/${j}/total`),{count:increment(1)}),await update(ref(analyticsDb,`${w}/returningUsers/monthly/${j}/country/${e}`),{count:increment(1)})),currentUser&&currentUser.uid){const z=()=>{const z="visible"===document.visibilityState?"online":"idle";update(U,{status:z,userLastSeen:Date.now()})};onDisconnect(U).set({status:"offline",userLastSeen:u}),document.addEventListener("visibilitychange",z),z()}}catch(z){throw console.error("presence failed:",z),z}}async function fetchLocationInfo(){const z=["1874cf82555e4b0a92757d43d75644d2","4df5b64e9f204b559e96dc3b6dd4a86b","482673d945c5418ba9327d5040870cd9","136eedb47fb14865a50c4b56843723d5","00adbd6bdf9641528ed76495c14cf000","11e9c42d7dba4031a0f7c3a27e78b5d3","ed21430487dc4042b7c874754a7375fb","19e8d406be0b4d0cbdd5f4d1cd4efc78"],M=z[Math.floor(Math.random()*z.length)],e=`https://api.ipgeolocation.io/ipgeo?apiKey=${M}`;try{const z=await fetch(e);if(!z.ok)throw new Error("API request failed");const M=await z.json();return{ip:(M.ip||"Unknown").toLowerCase(),country:(M.country_name||"Unknown").toLowerCase(),region:M.state_prov?M.state_prov.toLowerCase():"unknown",city:(M.city||"Unknown").toLowerCase(),code:M.country_code2||"Unknown"}}catch(z){return console.warn(`Failed to use API key: ${M}`,z.message),{ip:"unknown",country:"unknown",region:"unknown",city:"unknown",code:"unknown"}}}function sanitizeKey(z){return z?z.toLowerCase().replace(/\./g,"-").replace(/@/g,"_at_").replace(/#/g,"_hash_").replace(/\$/g,"_dollar_").replace(/\[/g,"_openbracket_").replace(/\]/g,"_closebracket_").replace(/\//g,"_slash_"):null}function desanitizeEmail(z){return z?z.replace(/-/g,".").replace(/_at_/g,"@").replace(/_hash_/g,"#").replace(/_dollar_/g,"$").replace(/_openbracket_/g,"[").replace(/_closebracket_/g,"]").replace(/_slash_/g,"/"):null}function sanitizeDate(z=new Date){return`${z.getFullYear()}${String(z.getMonth()+1).padStart(2,"0")}${String(z.getDate()).padStart(2,"0")}`}function sanitizeWeek(z=new Date){return`${z.getFullYear()}W${String(getWeekNumber(z)).padStart(2,"0")}`}function sanitizeMonth(z=new Date){return`${z.getFullYear()}${String(z.getMonth()+1).padStart(2,"0")}`}function getWeekNumber(z){const M=new Date(Date.UTC(z.getFullYear(),z.getMonth(),z.getDate())),e=(M.getUTCDay()+6)%7;M.setUTCDate(M.getUTCDate()-e+3);const t=M.valueOf();return M.setUTCMonth(0,1),4!==M.getUTCDay()&&M.setUTCMonth(0,1+(4-M.getUTCDay()+7)%7),1+Math.ceil((t-M)/6048e5)}initApp();